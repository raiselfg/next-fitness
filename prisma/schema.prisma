generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// =======================
// BETTER AUTH TABLES
// =======================

model User {
  id            String    @id
  name          String
  email         String
  emailVerified Boolean
  image         String
  createdAt     DateTime
  updatedAt     DateTime

  role          String?   @default("user")
  gender        Gender?
  birthDate     DateTime?
  height        Int?
  weight        Int?
  bodyFat       Int?
  activityLevel ActivityLevel?
  goal          Goal?
  priority      Priority?

  speed         Speed?
  level         Level?
  meals         Int?
  restrictions  String?
  location      Location?
  frequency     Int?
  healthIssues  String?

  sessions      Session[]
  accounts      Account[]
  programs      Program[]
  dailyLogs     DailyLog[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

// =======================
// FITNESS APP CORE
// =======================

model Exercise {
  id           String  @id @default(cuid())
  name         String
  muscleGroup  String
  videoUrl     String? // Ссылка на локальный GIF или YouTube
  instructions String?

  isSystem Boolean @default(true) // true = видят все, false = кастомное

  logs      ExerciseLog[]
  plannedIn PlannedExercise[]

  @@map("exercise")
}

model Program {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name     String
  isActive Boolean @default(true)

  // Цели от AI
  targetCalories Int
  targetProtein  Int
  targetCarbs    Int
  targetFat      Int

  workouts  WorkoutTemplate[]
  createdAt DateTime          @default(now())

  @@map("program")
}

model WorkoutTemplate {
  id        String  @id @default(cuid())
  programId String
  program   Program @relation(fields: [programId], references: [id], onDelete: Cascade)

  name      String
  dayOfWeek Int?

  exercises PlannedExercise[]

  @@map("workout_template")
}

model PlannedExercise {
  id                String          @id @default(cuid())
  workoutTemplateId String
  workoutTemplate   WorkoutTemplate @relation(fields: [workoutTemplateId], references: [id], onDelete: Cascade)

  exerciseId String
  exercise   Exercise @relation(fields: [exerciseId], references: [id])

  sets  Int
  reps  String
  order Int

  @@map("planned_exercise")
}

model DailyLog {
  id     String   @id @default(cuid())
  userId String
  user   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date   DateTime @db.Date // 2026-01-31

  calories Int @default(0)
  protein  Int @default(0)
  carbs    Int @default(0)
  fat      Int @default(0)

  meals    Meal[]
  workouts WorkoutSession[]

  @@unique([userId, date])
  @@map("daily_log")
}

model Meal {
  id         String   @id @default(cuid())
  dailyLogId String
  dailyLog   DailyLog @relation(fields: [dailyLogId], references: [id], onDelete: Cascade)

  name     String
  calories Int
  protein  Int
  carbs    Int
  fat      Int

  @@map("meal")
}

model WorkoutSession {
  id         String   @id @default(cuid())
  dailyLogId String
  dailyLog   DailyLog @relation(fields: [dailyLogId], references: [id], onDelete: Cascade)

  name        String
  completedAt DateTime @default(now())

  exercises ExerciseLog[]

  @@map("workout_session")
}

model ExerciseLog {
  id               String         @id @default(cuid())
  workoutSessionId String
  workoutSession   WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)

  exerciseId String
  exercise   Exercise @relation(fields: [exerciseId], references: [id])

  sets SetLog[]

  @@map("exercise_log")
}

model SetLog {
  id            String      @id @default(cuid())
  exerciseLogId String
  exerciseLog   ExerciseLog @relation(fields: [exerciseLogId], references: [id], onDelete: Cascade)

  weight Float
  reps   Int

  @@map("set_log")
}

enum Gender {
  male
  female
}

enum Goal {
  lose
  gain
  maintain
  recomposition
}

enum Speed {
  slow
  medium
  fast
}

enum Level {
  beginner
  intermediate
  advanced
}

enum Location {
  gym
  home_equipment
  home_no_equipment
  outdoor
}

enum ActivityLevel {
  sedentary
  lightly_active
  moderately_active
  very_active
  extra_active
}

enum Priority {
  strength
  hypertrophy
  endurance
  fat_loss
  health
  definition
}
